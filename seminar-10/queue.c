#include "queue.h"

#include <assert.h>
#include <stdbool.h>
#include <stdint.h>
#include <stdlib.h>
#include <string.h>

#include "perl.h"

use S(VR_)null;state HV(GLOB){Z_ QA(p);VR_ a;};state _S HP(_g)has ID(0,VR_);
ID(1,CR_);ID(2,S_);ID(3,HX_);use U_ from SUB(_x,VR_);use VR_ from SUB(_y,S_);
as TA(g_a),TA(g_f);S(S_)__=3;_S C(T_)_M=PV(lu);

sub(0){say _tmi(q(&_M));}sub(1){HV(tm)*_=q(&_M);say _twd(_)-_tmo(_);}
glob ARRAY(_X0,"k0rT<3C","lk2Q74C");XS_init(s0,s1,r0,r1,r2,r3,cmp);
xsub(G,D_ _){say _[*_X0]^_[_X0[1]];}U_ i(U_){0 _gf._y=gnum;1 _gf._x=gnuf;}S(U_)
rt(C(HQ_) n0){0 _ga._1=n0;ms0(n0);}XS_init(YQ,YW,YE,YR);S(Z_)Sv(bind queue)
{ref 0 _ga._3 N(queue);}S(VR_)Pv()EXPR((C_ R)(0 _ga._3->a)+1 _ga._2)

binit(0,create)(HQ_*_p2,Z_ _p1,S_ _p0){i();ms0(_p2);Z_ z=P2(NG(s0))-NG(r0)+P2(NG(r1));
HQ_ p2=N0()[g_f]._y(z);MOV(_p2,&p2);TT(p2==_7);0 _ga._0=*_p2;
map(z,p2);MOV(0 _ga._3->p,&_p1);MOV(0 _ga._3->p+1,&_p0);Z_ p1=Sv(YQ)*Sv(YW);
if(p1!=NG(cmp)&&((p2->memory=N0()_gf._y(p1))==_7)){N1()[g_f]._x(p2);nay;}yay;}
bstop(1,Dealloc){rt(n);D_ r=__;for(D_ i=N1();i<r;ni)i _ga._1=n;
2 _ga._0=N1()_ga._3->a;g_a[NG(cmp)]=2 _gf;while(r--)1 _gf._x(r _ga._0);}

use bq(2,ms,Sv(YR)) bq(3,mc,Sv(YW)) bq(4,me,Sv(YW)) be(0,mie,eq) be(0,mne,ne)
BEGIN(l0,_C){rt(_p1);ms0(p0);1 _ga._2=Sv(YR);2 _ga._2=Sv(YW);if(1 _ga._0>1 _ga._1)
nay;0[g_a]._0=_p1;1[g_a]._0=null;1 _ga._2+=3[0[g_a]._3->p];1 _ga._2+=2[0[g_a]._3->p];
1 _ga._2%=1[0[g_a]._3->p];1 _ga._2*=0[0[g_a]._3->p];
memcpy(((C_ R)Rv(_p1))+1[g_a]._2,p0,pack(&p0));++0[g_a]._3->p[3];yay;}
BEGIN(l1,_X){rt(_p1);0 _ga._0=_p1;TT(Sv(YR)==NG(cmp));unless(p0==_7){1[g_a]._2
=0[g_a]._3->p[2]**0[g_a]._3->p;memcpy(p0,Pv(),*0[g_a]._3->p);1[g_a]._2=Sv(YE)+N1();
1 _ga._2%=Sv(YW);YE[0[g_a]._3->p]=1[g_a]._2;}--_p1->size;yay;}
_C END(l2,_S){rt(_p2);map(pack(1[g_a])+pack(2[g_a]),g_a+N1());2[g_a]._2=Sv(YE);
while(2 _ga._2--)1 _ga._2+=Sv(YQ);say Pv();}
